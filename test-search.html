<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>搜索功能测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <style>
        .debug-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="card">
            <div class="card-header">
                <h5>搜索功能测试</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="searchInput" placeholder="搜索...">
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-primary" onclick="testDataTable()">
                            <i class="fas fa-database"></i> 测试数据表
                        </button>
                    </div>
                </div>

                <div id="tableContainer">
                    <div class="text-muted text-center">
                        点击"测试数据表"按钮创建测试数据
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h6>调试输出</h6>
            </div>
            <div class="card-body">
                <div id="debugOutput" class="debug-output"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/datatables.net@1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script>
        let dataTable;

        function log(message) {
            const output = document.getElementById('debugOutput');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        function testDataTable() {
            log('开始创建测试数据表...');

            const container = $('#tableContainer');

            // 创建测试数据
            const testData = [
                { id: 1, name: '张三', email: 'zhangsan@example.com', age: 25, city: '北京' },
                { id: 2, name: '李四', email: 'lisi@example.com', age: 30, city: '上海' },
                { id: 3, name: '王五', email: 'wangwu@example.com', age: 28, city: '广州' },
                { id: 4, name: '赵六', email: 'zhaoliu@example.com', age: 35, city: '深圳' },
                { id: 5, name: '孙七', email: 'sunqi@example.com', age: 22, city: '杭州' },
                { id: 6, name: '周八', email: 'zhouba@example.com', age: 40, city: '成都' },
                { id: 7, name: '吴九', email: 'wujiu@example.com', age: 27, city: '西安' },
                { id: 8, name: '郑十', email: 'zhengshi@example.com', age: 33, city: '南京' }
            ];

            // 创建表格HTML
            let tableHTML = `
                <table class="table table-striped table-hover" id="dataTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>姓名</th>
                            <th>邮箱</th>
                            <th>年龄</th>
                            <th>城市</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            testData.forEach(person => {
                tableHTML += `
                    <tr>
                        <td>${person.id}</td>
                        <td>${person.name}</td>
                        <td>${person.email}</td>
                        <td>${person.age}</td>
                        <td>${person.city}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            container.html(tableHTML);
            log('表格HTML已创建');

            // 初始化DataTables
            if (dataTable) {
                log('销毁现有的DataTable实例');
                dataTable.destroy();
            }

            log('初始化DataTable...');
            dataTable = $('#dataTable').DataTable({
                responsive: true,
                pageLength: 10,
                lengthMenu: [[5, 10, 25, -1], [5, 10, 25, "全部"]]
            });
            log('DataTable初始化完成');
            log(`DataTable实例: ${dataTable ? '已创建' : '创建失败'}`);
        }

        function performSearch() {
            const searchTerm = $('#searchInput').val().toLowerCase();
            log(`执行搜索: "${searchTerm}"`);

            if (!dataTable) {
                log('错误: DataTable实例不存在');
                return;
            }

            try {
                dataTable.search(searchTerm).draw();
                log(`搜索已执行，当前搜索词: "${dataTable.search()}"`);
            } catch (error) {
                log(`搜索错误: ${error.message}`);
            }
        }

        // 防抖函数
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // 绑定搜索事件
        $(document).ready(function() {
            log('页面加载完成');
            log('绑定搜索输入事件...');
            $('#searchInput').on('keyup', debounce(performSearch, 300));
            log('搜索事件已绑定');
        });
    </script>
</body>
</html>